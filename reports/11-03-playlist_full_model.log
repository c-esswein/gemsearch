nohup: ignoring input
2017-11-03 12:48:33,390 - summa.preprocessing.cleaner - INFO - 'pattern' package not found; tag filters are not available for English
2017-11-03 12:48:33,518 - __main__ - INFO - started playlist eval with config: {'dataDir': 'data/full_model/', 'outDir': 'data/rec/', 'SHOULD_GENERATE_GRAPH': True, 'SHOULD_INDEX_ES': True, 'TEST_PLAYLIST_SPLIT': 0.2, 'PRECISION_AT': [1, 5, 10], 'USE_USER_IN_QUERY': True, 'ARGS': Namespace(album=False, genre=False, tags=False)}
2017-11-03 12:48:33,518 - __main__ - INFO - %%% playlist_eval runner... 
2017-11-03 12:48:35,452 - gemsearch.evaluation.playlist_query_evaluator - INFO - Splitted playlists for training (17068) and test (4234), total (21336)
2017-11-03 12:48:35,452 - gemsearch.evaluation.playlist_query_evaluator - INFO - dropped because of invalid split (user in test but not in training) 34
------------- generate graph -------------
2017-11-03 12:48:35,695 - __main__ - INFO - %%% graph generation... 
2017-11-03 12:49:04,568 - gemsearch.core.type_counter - INFO - Collected items by type:
2017-11-03 12:49:04,572 - gemsearch.core.type_counter - INFO - track: 852293
2017-11-03 12:49:04,572 - gemsearch.core.type_counter - INFO - artist: 106581
2017-11-03 12:49:04,572 - gemsearch.core.type_counter - INFO - user: 1148
2017-11-03 12:49:04,572 - gemsearch.core.type_counter - INFO - -- Total: 960022 --
2017-11-03 12:49:04,573 - __main__ - INFO - %%% graph generation done in 28.878s


2017-11-03 12:49:04,573 - __main__ - INFO - %%% elastic search writer... 
all indexes cleared
{'_shards': {'failed': 0, 'successful': 5, 'total': 5}, 'count': 958874}
2017-11-03 12:50:38,802 - __main__ - INFO - %%% elastic search writer done in 94.229s


2017-11-03 12:50:38,802 - __main__ - INFO - %%% embedding 20_20_10_64_deepwalk... 
2017-11-03 12:50:38,802 - deepwalk.runner - INFO - started deepwalk with config: Namespace(debug=False, format='edgelist', input='data/rec/graph.txt', log='INFO', max_memory_data_size=7000000, method='deepwalk', number_walks=20, output='data/rec/deepwalk.em', representation_size=64, seed=42, undirected=True, vertex_freq_degree=False, walk_length=20, weighted=True, window_size=10, workers=3)
2017-11-03 12:50:47,339 - deepwalk - INFO - make_consistent: made consistent in 2.541551351547241s
2017-11-03 12:50:48,048 - deepwalk - INFO - remove_self_loops: removed 0 loops in 0.7088141441345215s
2017-11-03 12:50:48,049 - deepwalk.runner - INFO - Number of nodes: 960022
2017-11-03 12:50:48,049 - deepwalk.runner - INFO - Number of walks: 19200440
2017-11-03 12:50:48,049 - deepwalk.runner - INFO - Data size (walks*length): 384008800
2017-11-03 12:50:48,049 - deepwalk.runner - INFO - Data size 384008800 is larger than limit (max-memory-data-size: 7000000).  Dumping walks to disk.
2017-11-03 12:50:48,049 - deepwalk.runner - INFO - Start Walking...
2017-11-03 13:10:15,126 - deepwalk.runner - INFO - Start Training...
2017-11-03 14:28:50,964 - deepwalk.runner - INFO - Delete serialized walks
2017-11-03 14:28:51,454 - gensim.models.keyedvectors - INFO - storing 960022x64 projection weights into data/rec/deepwalk.em
2017-11-03 14:29:28,581 - __main__ - INFO - %%% embedding 20_20_10_64_deepwalk done in 5929.778s


2017-11-03 14:29:28,581 - __main__ - INFO - %%% ge calc initializing... 
2017-11-03 14:30:00,195 - __main__ - INFO - %%% ge calc initializing done in 31.613s


2017-11-03 14:30:00,195 - __main__ - INFO - ------------- evaluation -------------
2017-11-03 14:30:00,195 - __main__ - INFO - %%% evaluation... 
2017-11-03 14:30:00,196 - gemsearch.evaluation.playlist_query_evaluator - INFO - Extract queries from playlist names (result is cached)
2017-11-03 14:37:02,630 - gemsearch.evaluation.playlist_query_evaluator - INFO - For evaluation 4139 of 4234 playlists are left
2017-11-03 14:37:02,635 - gemsearch.evaluation.playlist_query_evaluator - INFO - Started playlist evaluation with 4139 playlists
2017-11-03 17:09:14,326 - gemsearch.evaluation.playlist_query_evaluator - INFO - Playlist evaluation finished: total 4139 playlists (testsplit=0.2)
{'rec_first_two_query_tracks@1': {'avg_hits': 0.11307079004590481,
                                  'avg_hits_on_has_hits': 1.0,
                                  'has_hits': 468,
                                  'precision': 0.11307079004590481,
                                  'precision_on_has_hits': 1.0,
                                  'recall': 0.008140748439739528},
 'rec_first_two_query_tracks@10': {'avg_hits': 1.0101473785938633,
                                   'avg_hits_on_has_hits': 4.350676378772112,
                                   'has_hits': 961,
                                   'precision': 0.10101473785938646,
                                   'precision_on_has_hits': 0.4350676378772118,
                                   'recall': 0.07139650175791902},
 'rec_first_two_query_tracks@5': {'avg_hits': 0.5247644358540711,
                                  'avg_hits_on_has_hits': 2.7989690721649483,
                                  'has_hits': 776,
                                  'precision': 0.10495288717081379,
                                  'precision_on_has_hits': 0.5597938144329875,
                                  'recall': 0.03825432214627272},
 'rec_first_two_query_tracks_mean@1': {'avg_hits': 0.11307079004590481,
                                       'avg_hits_on_has_hits': 1.0,
                                       'has_hits': 468,
                                       'precision': 0.11307079004590481,
                                       'precision_on_has_hits': 1.0,
                                       'recall': 0.008140748439739528},
 'rec_first_two_query_tracks_mean@10': {'avg_hits': 1.0101473785938633,
                                        'avg_hits_on_has_hits': 4.350676378772112,
                                        'has_hits': 961,
                                        'precision': 0.10101473785938646,
                                        'precision_on_has_hits': 0.4350676378772118,
                                        'recall': 0.07139650175791902},
 'rec_first_two_query_tracks_mean@5': {'avg_hits': 0.5247644358540711,
                                       'avg_hits_on_has_hits': 2.7989690721649483,
                                       'has_hits': 776,
                                       'precision': 0.10495288717081379,
                                       'precision_on_has_hits': 0.5597938144329875,
                                       'recall': 0.03825432214627272},
 'rec_query_tracks@1': {'avg_hits': 0.1166948538294274,
                        'avg_hits_on_has_hits': 1.0,
                        'has_hits': 483,
                        'precision': 0.1166948538294274,
                        'precision_on_has_hits': 1.0,
                        'recall': 0.008542916821027993},
 'rec_query_tracks@10': {'avg_hits': 1.001449625513409,
                         'avg_hits_on_has_hits': 4.68361581920904,
                         'has_hits': 885,
                         'precision': 0.10014496255134095,
                         'precision_on_has_hits': 0.46836158192090416,
                         'recall': 0.07116789604551385},
 'rec_query_tracks@5': {'avg_hits': 0.5221067890794878,
                        'avg_hits_on_has_hits': 2.9123989218328843,
                        'has_hits': 742,
                        'precision': 0.10442135781589719,
                        'precision_on_has_hits': 0.5824797843665748,
                        'recall': 0.03822476109872352},
 'rec_query_tracks_with_user@1': {'avg_hits': 0.025126842232423292,
                                  'avg_hits_on_has_hits': 1.0,
                                  'has_hits': 104,
                                  'precision': 0.025126842232423292,
                                  'precision_on_has_hits': 1.0,
                                  'recall': 0.001232372734425806},
 'rec_query_tracks_with_user@10': {'avg_hits': 0.16598212128533463,
                                   'avg_hits_on_has_hits': 1.6674757281553398,
                                   'has_hits': 412,
                                   'precision': 0.016598212128533515,
                                   'precision_on_has_hits': 0.1667475728155345,
                                   'recall': 0.005889340980276162},
 'rec_query_tracks_with_user@5': {'avg_hits': 0.09011838608359507,
                                  'avg_hits_on_has_hits': 1.3087719298245615,
                                  'has_hits': 285,
                                  'precision': 0.018023677216719085,
                                  'precision_on_has_hits': 0.2617543859649133,
                                  'recall': 0.003503294586479677},
 'rec_query_tracks_with_user_mean@1': {'avg_hits': 0.05073689296931626,
                                       'avg_hits_on_has_hits': 1.0,
                                       'has_hits': 210,
                                       'precision': 0.05073689296931626,
                                       'precision_on_has_hits': 1.0,
                                       'recall': 0.0026904415224316795},
 'rec_query_tracks_with_user_mean@10': {'avg_hits': 0.3186760086977531,
                                        'avg_hits_on_has_hits': 2.1622950819672133,
                                        'has_hits': 610,
                                        'precision': 0.03186760086977515,
                                        'precision_on_has_hits': 0.21622950819672024,
                                        'recall': 0.014331652728788113},
 'rec_query_tracks_with_user_mean@5': {'avg_hits': 0.1807199806716598,
                                       'avg_hits_on_has_hits': 1.636761487964989,
                                       'has_hits': 457,
                                       'precision': 0.03614399613433199,
                                       'precision_on_has_hits': 0.32735229759299805,
                                       'recall': 0.008513234851020077},
 'rec_query_tracks_with_user_scaled@1': {'avg_hits': 0.08987678183136023,
                                         'avg_hits_on_has_hits': 1.0,
                                         'has_hits': 372,
                                         'precision': 0.08987678183136023,
                                         'precision_on_has_hits': 1.0,
                                         'recall': 0.005404422038915004},
 'rec_query_tracks_with_user_scaled@10': {'avg_hits': 0.7637110413143271,
                                          'avg_hits_on_has_hits': 3.2621259029927763,
                                          'has_hits': 969,
                                          'precision': 0.07637110413143255,
                                          'precision_on_has_hits': 0.3262125902992769,
                                          'recall': 0.04468403566014511},
 'rec_query_tracks_with_user_scaled@5': {'avg_hits': 0.4020294757187727,
                                         'avg_hits_on_has_hits': 2.1780104712041886,
                                         'has_hits': 764,
                                         'precision': 0.08040589514375401,
                                         'precision_on_has_hits': 0.4356020942408349,
                                         'recall': 0.023659510909228243},
 'rec_random_tracks@1': {'avg_hits': 0.0,
                         'avg_hits_on_has_hits': 0,
                         'has_hits': 0,
                         'precision': 0.0,
                         'precision_on_has_hits': 0,
                         'recall': 0.0},
 'rec_random_tracks@10': {'avg_hits': 0.000724812756704518,
                          'avg_hits_on_has_hits': 1.0,
                          'has_hits': 3,
                          'precision': 7.248127567045181e-05,
                          'precision_on_has_hits': 0.10000000000000002,
                          'recall': 6.081726332095762e-06},
 'rec_random_tracks@5': {'avg_hits': 0.00024160425223483932,
                         'avg_hits_on_has_hits': 1.0,
                         'has_hits': 1,
                         'precision': 4.832085044696787e-05,
                         'precision_on_has_hits': 0.2,
                         'recall': 9.364505900575168e-07},
 'rec_tracks_with_user@1': {'avg_hits': 0.01087219135056777,
                            'avg_hits_on_has_hits': 1.0,
                            'has_hits': 45,
                            'precision': 0.01087219135056777,
                            'precision_on_has_hits': 1.0,
                            'recall': 0.00024326743216137255},
 'rec_tracks_with_user@10': {'avg_hits': 0.09374244986711766,
                             'avg_hits_on_has_hits': 1.515625,
                             'has_hits': 256,
                             'precision': 0.009374244986711796,
                             'precision_on_has_hits': 0.1515625000000005,
                             'recall': 0.002082253341157811},
 'rec_tracks_with_user@5': {'avg_hits': 0.04783764194249819,
                            'avg_hits_on_has_hits': 1.2452830188679245,
                            'has_hits': 159,
                            'precision': 0.009567528388499641,
                            'precision_on_has_hits': 0.24905660377358502,
                            'recall': 0.0010260172017857927}}
2017-11-03 17:09:14,331 - __main__ - INFO - %%% evaluation done in 9554.135s


------------- done -------------
{'20_20_10_64_deepwalk': {'rec_first_two_query_tracks@1': {'avg_hits': 0.11307079004590481,
                                                           'avg_hits_on_has_hits': 1.0,
                                                           'has_hits': 468,
                                                           'precision': 0.11307079004590481,
                                                           'precision_on_has_hits': 1.0,
                                                           'recall': 0.008140748439739528},
                          'rec_first_two_query_tracks@10': {'avg_hits': 1.0101473785938633,
                                                            'avg_hits_on_has_hits': 4.350676378772112,
                                                            'has_hits': 961,
                                                            'precision': 0.10101473785938646,
                                                            'precision_on_has_hits': 0.4350676378772118,
                                                            'recall': 0.07139650175791902},
                          'rec_first_two_query_tracks@5': {'avg_hits': 0.5247644358540711,
                                                           'avg_hits_on_has_hits': 2.7989690721649483,
                                                           'has_hits': 776,
                                                           'precision': 0.10495288717081379,
                                                           'precision_on_has_hits': 0.5597938144329875,
                                                           'recall': 0.03825432214627272},
                          'rec_first_two_query_tracks_mean@1': {'avg_hits': 0.11307079004590481,
                                                                'avg_hits_on_has_hits': 1.0,
                                                                'has_hits': 468,
                                                                'precision': 0.11307079004590481,
                                                                'precision_on_has_hits': 1.0,
                                                                'recall': 0.008140748439739528},
                          'rec_first_two_query_tracks_mean@10': {'avg_hits': 1.0101473785938633,
                                                                 'avg_hits_on_has_hits': 4.350676378772112,
                                                                 'has_hits': 961,
                                                                 'precision': 0.10101473785938646,
                                                                 'precision_on_has_hits': 0.4350676378772118,
                                                                 'recall': 0.07139650175791902},
                          'rec_first_two_query_tracks_mean@5': {'avg_hits': 0.5247644358540711,
                                                                'avg_hits_on_has_hits': 2.7989690721649483,
                                                                'has_hits': 776,
                                                                'precision': 0.10495288717081379,
                                                                'precision_on_has_hits': 0.5597938144329875,
                                                                'recall': 0.03825432214627272},
                          'rec_query_tracks@1': {'avg_hits': 0.1166948538294274,
                                                 'avg_hits_on_has_hits': 1.0,
                                                 'has_hits': 483,
                                                 'precision': 0.1166948538294274,
                                                 'precision_on_has_hits': 1.0,
                                                 'recall': 0.008542916821027993},
                          'rec_query_tracks@10': {'avg_hits': 1.001449625513409,
                                                  'avg_hits_on_has_hits': 4.68361581920904,
                                                  'has_hits': 885,
                                                  'precision': 0.10014496255134095,
                                                  'precision_on_has_hits': 0.46836158192090416,
                                                  'recall': 0.07116789604551385},
                          'rec_query_tracks@5': {'avg_hits': 0.5221067890794878,
                                                 'avg_hits_on_has_hits': 2.9123989218328843,
                                                 'has_hits': 742,
                                                 'precision': 0.10442135781589719,
                                                 'precision_on_has_hits': 0.5824797843665748,
                                                 'recall': 0.03822476109872352},
                          'rec_query_tracks_with_user@1': {'avg_hits': 0.025126842232423292,
                                                           'avg_hits_on_has_hits': 1.0,
                                                           'has_hits': 104,
                                                           'precision': 0.025126842232423292,
                                                           'precision_on_has_hits': 1.0,
                                                           'recall': 0.001232372734425806},
                          'rec_query_tracks_with_user@10': {'avg_hits': 0.16598212128533463,
                                                            'avg_hits_on_has_hits': 1.6674757281553398,
                                                            'has_hits': 412,
                                                            'precision': 0.016598212128533515,
                                                            'precision_on_has_hits': 0.1667475728155345,
                                                            'recall': 0.005889340980276162},
                          'rec_query_tracks_with_user@5': {'avg_hits': 0.09011838608359507,
                                                           'avg_hits_on_has_hits': 1.3087719298245615,
                                                           'has_hits': 285,
                                                           'precision': 0.018023677216719085,
                                                           'precision_on_has_hits': 0.2617543859649133,
                                                           'recall': 0.003503294586479677},
                          'rec_query_tracks_with_user_mean@1': {'avg_hits': 0.05073689296931626,
                                                                'avg_hits_on_has_hits': 1.0,
                                                                'has_hits': 210,
                                                                'precision': 0.05073689296931626,
                                                                'precision_on_has_hits': 1.0,
                                                                'recall': 0.0026904415224316795},
                          'rec_query_tracks_with_user_mean@10': {'avg_hits': 0.3186760086977531,
                                                                 'avg_hits_on_has_hits': 2.1622950819672133,
                                                                 'has_hits': 610,
                                                                 'precision': 0.03186760086977515,
                                                                 'precision_on_has_hits': 0.21622950819672024,
                                                                 'recall': 0.014331652728788113},
                          'rec_query_tracks_with_user_mean@5': {'avg_hits': 0.1807199806716598,
                                                                'avg_hits_on_has_hits': 1.636761487964989,
                                                                'has_hits': 457,
                                                                'precision': 0.03614399613433199,
                                                                'precision_on_has_hits': 0.32735229759299805,
                                                                'recall': 0.008513234851020077},
                          'rec_query_tracks_with_user_scaled@1': {'avg_hits': 0.08987678183136023,
                                                                  'avg_hits_on_has_hits': 1.0,
                                                                  'has_hits': 372,
                                                                  'precision': 0.08987678183136023,
                                                                  'precision_on_has_hits': 1.0,
                                                                  'recall': 0.005404422038915004},
                          'rec_query_tracks_with_user_scaled@10': {'avg_hits': 0.7637110413143271,
                                                                   'avg_hits_on_has_hits': 3.2621259029927763,
                                                                   'has_hits': 969,
                                                                   'precision': 0.07637110413143255,
                                                                   'precision_on_has_hits': 0.3262125902992769,
                                                                   'recall': 0.04468403566014511},
                          'rec_query_tracks_with_user_scaled@5': {'avg_hits': 0.4020294757187727,
                                                                  'avg_hits_on_has_hits': 2.1780104712041886,
                                                                  'has_hits': 764,
                                                                  'precision': 0.08040589514375401,
                                                                  'precision_on_has_hits': 0.4356020942408349,
                                                                  'recall': 0.023659510909228243},
                          'rec_random_tracks@1': {'avg_hits': 0.0,
                                                  'avg_hits_on_has_hits': 0,
                                                  'has_hits': 0,
                                                  'precision': 0.0,
                                                  'precision_on_has_hits': 0,
                                                  'recall': 0.0},
                          'rec_random_tracks@10': {'avg_hits': 0.000724812756704518,
                                                   'avg_hits_on_has_hits': 1.0,
                                                   'has_hits': 3,
                                                   'precision': 7.248127567045181e-05,
                                                   'precision_on_has_hits': 0.10000000000000002,
                                                   'recall': 6.081726332095762e-06},
                          'rec_random_tracks@5': {'avg_hits': 0.00024160425223483932,
                                                  'avg_hits_on_has_hits': 1.0,
                                                  'has_hits': 1,
                                                  'precision': 4.832085044696787e-05,
                                                  'precision_on_has_hits': 0.2,
                                                  'recall': 9.364505900575168e-07},
                          'rec_tracks_with_user@1': {'avg_hits': 0.01087219135056777,
                                                     'avg_hits_on_has_hits': 1.0,
                                                     'has_hits': 45,
                                                     'precision': 0.01087219135056777,
                                                     'precision_on_has_hits': 1.0,
                                                     'recall': 0.00024326743216137255},
                          'rec_tracks_with_user@10': {'avg_hits': 0.09374244986711766,
                                                      'avg_hits_on_has_hits': 1.515625,
                                                      'has_hits': 256,
                                                      'precision': 0.009374244986711796,
                                                      'precision_on_has_hits': 0.1515625000000005,
                                                      'recall': 0.002082253341157811},
                          'rec_tracks_with_user@5': {'avg_hits': 0.04783764194249819,
                                                     'avg_hits_on_has_hits': 1.2452830188679245,
                                                     'has_hits': 159,
                                                     'precision': 0.009567528388499641,
                                                     'precision_on_has_hits': 0.24905660377358502,
                                                     'recall': 0.0010260172017857927}}}
2017-11-03 17:09:14,956 - __main__ - INFO - %%% playlist_eval runner done in 15641.437s


